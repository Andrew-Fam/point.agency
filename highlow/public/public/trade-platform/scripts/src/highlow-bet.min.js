highlowApp.betSystem={bets:{},sellPopup:function(t){$(".trading-platform-sell-popup."+t.type).removeClass("concealed"),$(".trading-platform-sell-popup."+t.type+" .trading-platform-sell-popup-instrument").html(t.model.label),$(".trading-platform-sell-popup."+t.type+" .trading-platform-invevstment-value").html("$"+t.amount),$(".trading-platform-sell-popup."+t.type+" .trading-platform-pay-out-value").html("$"+parseFloat(t.amount*parseFloat($(".trading-platform-sell-popup."+t.type+" .trading-platform-return-rate-value .rate").html())).toFixed(2))},createBetEntry:function(t,e,a,i,n){var s=new Date(e.x),o=new Date(n.expireAt),l=n.strike,r=$('<tr data-uid="'+a+'"><td class="investment-select"></td><td class="investment-type '+i+'"></td><td class="investment-asset">'+t.model.label+'</td><td class="investment-strike highlow-'+t.direction+'"> '+l+'</td><td class="investment-time">'+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+s.getMinutes())+'</td><td class="investment-expiry">'+o.getHours()+":"+(o.getMinutes()>9?o.getMinutes():"0"+o.getMinutes())+'</td><td class="investment-status">Opened</td><td class="investment-closing-rate">-</td><td>$<span class="investment-value">'+$("#"+i+"-investment-value-input").val()+'</span></td><td class="investment-payout font-b"></td><td class="investment-sell"><button data-investment="'+$("#investment-value-input").val()+'" class="investment-sell-btn '+i+' btn font-m btn-sm-pad">SELL</button></td></tr>');r.on("click",function(){function e(){i>o&&(highlowApp.instrumentPanelSlider.nextPage(r.data("target")),p++),o>i&&(highlowApp.instrumentPanelSlider.previousPage(l.data("target")),p++),d>p&&setTimeout(e,1.2*highlowApp.instrumentPanelSlider.slidingTime)}$('[data-target="#'+n.type+'-mode"]').click(),$('[data-target="#'+n.type+"-"+t.model.durationId+'"]').click(),$("#"+n.type+"-"+t.model.durationId+' [data-uid="'+t.model.uid+'"]').click();var a=$($("#"+n.type+"-"+t.model.durationId+" .instrument-panel-active").closest(".page")),i=a.index(),s=$("#"+n.type+"-"+t.model.durationId+" .page.active"),o=s.index(),l=$("#"+n.type+"-"+t.model.durationId+" .page-slider.backward"),r=$("#"+n.type+"-"+t.model.durationId+" .page-slider.forward"),d=Math.abs(i-o),p=0;e()}),r.on("click",".investment-sell-btn",function(e){e.preventDefault(),highlowApp.betSystem.sellPopup(t)}),$(".trading-platform-investments-list").append(r),$(".trading-platform-investments").removeClass("no-data")},updateBetEntry:function(t,e){var a,i='[data-uid="'+t.uid+'"]',n=parseFloat(t.strike).toFixed(highlowApp.marketSimulator.rounding),s=parseFloat(e.currentRate).toFixed(highlowApp.marketSimulator.rounding),o=1,l=-1,r=0;switch(t.direction){case"high":s>n&&(a=o),n>s&&(a=l),s==n&&(a=r);break;case"low":s>n&&(a=l),n>s&&(a=o),s==n&&(a=r)}t.expired?($("tr"+i+" .investment-status").html("Closed"),$("tr"+i+" .investment-closing-rate").html(t.closingRate)):a===o?($("tr"+i).removeClass().addClass("investment-winning"),$("tr"+i+" .investment-payout").html("$"+Math.floor(t.amount*t.model.payoutRate))):a===l?($("tr"+i).removeClass().addClass("investment-losing"),$("tr"+i+" .investment-payout").html("$0")):($("tr"+i).removeClass().addClass("investment-tying"),$("tr"+i+" .investment-payout").html("$"+t.amount))},confirmBet:function(t,e,a){$(".trading-select-direction-"+a+"-"+t).click(),$(".trading-platform-invest-popup."+a).removeClass("concealed")},placeBet:function(t,e){$(".trading-platform-invest-popup").addClass("concealed");var a=(new Date).getTime(),i=$("#"+e+"-graph").highcharts(),n=i.series[0],s=(i.renderer,this.bets),o=$("#"+e+"-main-view").data("instrumentModel");s[e]||(s[e]=[]);// if(bet!="high" && bet!="low") {
var l=$("#"+e+"-investment-value-input").val(),r=parseFloat(o.currentRate).toFixed(3);"spread"==e&&("high"==t&&(r=(parseFloat(o.currentRate)+highlowApp.marketSimulator.spread).toFixed(3)),"low"==t&&(r=(parseFloat(o.currentRate)-highlowApp.marketSimulator.spread).toFixed(3)));var d=o.expireAt;e.indexOf("on-demand")>=0&&(d=a+18e4);var p=n.points[n.points.length-1],t={direction:t,type:o.type,amount:l,betAt:a,strike:r,expireAt:d,point:p,model:o,focused:!0,x:p.x,uid:o.uid+"-"+p.x+"-"+(n.points.length-1),focus:function(){void 0!=o.focusedBet&&(o.focusedBet.focused=!1),o.focusedBet=t,o.focusedBet.focused=!0,highlowApp.marketSimulator.updateBetStatus(o)}};t.focus(),o.bets.push(t),highlowApp.graph.placeBet(t),this.createBetEntry(t,p,t.uid,o.type,t),highlowApp.marketSimulator.updateBetStatus(o)},init:function(){var t=this;$(".trading-platform-main-controls-select-direction .btn").click(function(){$(".trading-platform-main-controls-select-direction .btn").removeClass("active").addClass("in-active"),$(this).hasClass("active")?$(this).removeClass("active"):$(this).hasClass("highlow-up")?$(".trading-platform-main-controls-select-direction .btn.highlow-up").addClass("active").removeClass("in-active"):$(".trading-platform-main-controls-select-direction .btn.highlow-down").addClass("active").removeClass("in-active")}),$(".trading-platform-main-controls-place-bet").click(function(){var e=$('input:radio[name="'+$(this).data("direction")+'"]:checked').val(),a=$(this).data("type");return e&&""!=e?(t.placeBet(e,a),$(".trading-platform-invest-popup."+a).addClass("concealed"),$(".trading-platform-main-controls-select-direction .btn").removeClass("active").removeClass("in-active"),$('input:radio[name="'+$(this).data("direction")+'"]:checked').prop("checked",!1),void 0):(console.log("Please select high or low"),void 0)}),$(".one-touch-bet").click(function(){var e=$(this).data("direction"),a=$(this).data("type");t.placeBet(e,a)})}};