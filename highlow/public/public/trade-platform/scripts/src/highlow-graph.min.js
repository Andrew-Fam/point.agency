highlowApp.graph={graphs:{},onGraphUI:{},init:function(){Highcharts.setOptions({plotOptions:{series:{animation:!1}},global:{useUTC:!1}}),this.prepareGraph("#highlow-graph"),this.prepareGraph("#spread-graph"),this.prepareGraph("#on-demand-graph",12e4),this.prepareGraph("#spread-on-demand-graph",12e4),this.graphs.highlow=Highcharts.charts[$("#highlow-graph").data("highchartsChart")],this.graphs.spread=Highcharts.charts[$("#spread-graph").data("highchartsChart")],this.graphs["on-demand"]=Highcharts.charts[$("#on-demand-graph").data("highchartsChart")],this.graphs["spread-on-demand"]=Highcharts.charts[$("#spread-on-demand-graph").data("highchartsChart")],this.mouse={x:0,y:0};var e=this;$(document).on("mousemove",function(t){e.mouse.x=t.clientX||t.pageX,e.mouse.y=t.clientY||t.pageY})},isOneClick:function(e){var t=$("#"+e.type+"-main-view");return t.hasClass(highlowApp.oneClick.className)},indexOfPointByXRecursive:function(e,t,o,r){if(o>r)return null;var a=Math.floor((o+r)/2);return e[a].x>t?this.indexOfPointByXRecursive(e,t,o,a-1):e[a].x<t?this.indexOfPointByXRecursive(e,t,a+1,r):a},loadInstrument:function(e){var t=(new Date).getTime(),o=e.type,r=this.onGraphUI;r[o]&&(r[o].highButton&&(r[o].highButton.destroy(),r[o].highButton=void 0),r[o].lowButton&&(r[o].lowButton.destroy(),r[o].lowButton=void 0)),$("#"+e.type+"-graph").highcharts().destroy(),this.prepareGraph("#"+e.type+"-graph"),this.graphs[e.type]=$("#"+e.type+"-graph").highcharts();var a=this.graphs[e.type],n=a.renderer,i=$("#"+e.type+"-graph").closest(".trading-platform-live-graph").hasClass("pushed");if(i){n.path(["M",790,5,"L",790,272]).attr({"stroke-width":1,stroke:"#252323"}).add(),n.path(["M",49,272,"L",790,272]).attr({"stroke-width":1,stroke:"#252323"}).add()}else{n.path(["M",840,5,"L",840,272]).attr({"stroke-width":1,stroke:"#252323"}).add(),n.path(["M",49,272,"L",840,272]).attr({"stroke-width":1,stroke:"#252323"}).add()}var s=a.series[0],d=JSON.parse(JSON.stringify(e.data));s.setData(d,!0,!1,!1);var p=a.xAxis[0];if(e.type.indexOf("on-demand")>=0){p.setExtremes(t-6e5,t+18e4,!0);var h=e.type+"-expiry-hint-line",l=e.type+"-expiry-hint-text";if(p.removePlotLine(h),e.bets.length>0)void 0!=e.onDemandHintText&&(e.onDemandHintText.destroy(),e.onDemandHintText=void 0);else{p.addPlotLine({color:"#606060",value:t+18e4,width:1,zIndex:1e3,id:h});var m=p.toPixels(t+18e4)-6,g=141;text=n.text("NEXT EXPIRY IN 60 SECS",m,g),text.css({"font-family":"Montserrat","font-size":"10px;",color:"white"}),text.attr({zIndex:6,id:l,transform:"translate(0,0) rotate(270 "+m+" "+g+")",width:"177px","text-anchor":"middle"}),text.add(),e.onDemandHintText=text}}else{var c=6e5;e.duration>9e5&&(c=18e5),e.duration>36e5&&(c=108e5),p.setExtremes(e.openAt-c,e.expireAt,!0);{var x=e.type+"-plot-band",u=e.type+"-start-plot-line",f=e.type+"-end-plot-line",v=e.type+"-dead-zone-line",y=e.type+"-dead-zone-band";e.type+"-start-text",e.type+"-dead-zone-text"}p.removePlotBand(x),p.addPlotBand({color:"rgba(20,20,20,0.3)",from:e.openAt,to:e.expireAt,id:x}),p.removePlotLine(u),p.addPlotLine({color:"rgba(255,255,255,0.7)",value:e.openAt,width:1,zIndex:1e3,id:u}),p.removePlotLine(f),p.addPlotLine({color:"rgba(255,255,255,0.7)",value:e.expireAt,width:1,zIndex:1e3,id:f}),p.removePlotBand(y),p.addPlotBand({from:e.deadzone,to:e.expireAt,color:{pattern:"common/images/deadzone-bg.png",width:4,height:4},id:y}),p.removePlotLine(v),p.addPlotLine({color:"rgba(255,255,255,0.4)",value:e.deadzone,width:1,zIndex:3,id:v});var g=10,w=p.toPixels(e.openAt)-70,b=p.toPixels(e.deadzone)-70;e.startTimeText&&e.startTimeText.element.remove(),e.deadTimeText&&e.deadTimeText.element.remove(),e.startTimeText=n.text("Start: "+highlowApp.timeToText(e.openAt),w,24),e.deadTimeText=n.text("Stop: "+highlowApp.timeToText(e.deadzone),b,24),e.startTimeText.css({color:"#838383",zIndex:10}),e.deadTimeText.css({color:"#838383",zIndex:11}),e.startTimeText.add(),e.deadTimeText.add()}s.points[s.points.length-1].update({marker:{enabled:!0,symbol:"url(common/images/graph-marker.png)",zIndex:1e3},states:{hover:{enabled:!1}},zIndex:1e3}),a.yAxis[0].addPlotLine({color:"#ffffff",width:1,dashStyle:"ShortDash",value:e.currentRate,zIndex:4,id:"current-value"}),this.updateOnGraphUI(e,s.points[s.points.length-1]);for(var B=0;B<e.bets.length;B++){var k=e.bets[B];e.type.indexOf("on-demand")>=0&&(k.finishLabel=void 0,k.finishText=void 0),k.point=s.points[this.indexOfPointByXRecursive(s.points,k.x,0,s.points.length-1)],this.placeBet(k)}var T=3e5;e.duration>9e5&&(T=9e5),e.duration>36e5&&(T=144e5),a.xAxis[0].update({tickInterval:T})},updateOnGraphUI:function(e,t){var o=this.onGraphUI,r=e.type;o[r]||(o[r]={}),o[r].lowRate&&(o[r].lowRate.destroy(),o[r].lowRate=void 0),o[r].highRate&&(o[r].highRate.destroy(),o[r].highRate=void 0);var a=this.graphs[e.type],n=(a.series[0],a.renderer),i=a.xAxis[0],s=a.yAxis[0];if(s.removePlotLine("current-value"),s.addPlotLine({color:"#ffffff",width:1,dashStyle:"ShortDash",value:t.y,zIndex:4,id:"current-value"}),r.indexOf("on-demand")>=0){i.setExtremes(t.x-6e5,t.x+18e4,!0);var d=e.type+"-expiry-hint-line";i.removePlotLine(d),e.bets.length>0?void 0!=e.onDemandHintText&&(e.onDemandHintText.destroy(),e.onDemandHintText=void 0):i.addPlotLine({color:"#606060",value:t.x+18e4,width:1,zIndex:1e3,id:d})}var p=s.getExtremes(),h=p.min,l=p.max,m=(l+h)/2,g=.005,c=.002,x=8,u=l,f=h;t.y>m?l-t.y<g&&(u+=g-(l-t.y),f=u-c*x,s.setExtremes(f,u,!0)):t.y-h<g&&(f-=g-(t.y-h),u=f+c*x,s.setExtremes(f,u,!0)),pointX=t.plotX,pointY=t.plotY;var v=pointX+76,y=pointY-37,w=pointX+76,b=pointY+22;(5>y||b>230)&&(y=pointY-7,v=pointX+68,b=pointY-7,w=pointX+104,"spread"==r&&(w+=69));var B="in-chart-"+r+"-high-bet",k="in-chart-"+r+"-low-bet";if(e.dead)o[r].highButton&&(o[r].highButton.destroy(),o[r].highButton=void 0),o[r].lowButton&&(o[r].lowButton.destroy(),o[r].lowButton=void 0);else{if(o[r].highButton)o[r].lowButton.attr({x:w,y:b}),o[r].highButton.attr({x:v,y:y});else{console.log("recreate on graph buttons");var T={},z={};T=o.highBetButtonHover?r.indexOf("spread")>=0?n.image("common/images/graph-up-spread-hover.png",v,y,96,27):n.image("common/images/graph-up-hover.png",v,y,27,27):r.indexOf("spread")>=0?n.image("common/images/graph-up-spread.png",v,y,96,27):n.image("common/images/graph-up.png",v,y,27,27),T.attr({zIndex:"10",id:B}),T.on("click",function(){// if(!highlowApp.graph.isOneClick(model)) {
highlowApp.betSystem.confirmBet("high",t,e.type)}),T.on("mouseover",function(){o.highBetButtonHover=!0,r.indexOf("spread")>=0?$("#"+B).attr("href","common/images/graph-up-spread-hover.png"):$("#"+B).attr("href","common/images/graph-up-hover.png")}),T.on("mouseleave",function(){o.highBetButtonHover=!1,r.indexOf("spread")>=0?$("#"+B).attr("href","common/images/graph-up-spread.png"):$("#"+B).attr("href","common/images/graph-up.png")}),T.add(),T.css({cursor:"pointer"}),o[r].highButton=T,z=o.lowBetButtonHover?r.indexOf("spread")>=0?n.image("common/images/graph-down-spread-hover.png",w,b,96,27):n.image("common/images/graph-down-hover.png",w,b,27,27):r.indexOf("spread")>=0?n.image("common/images/graph-down-spread.png",w,b,96,27):n.image("common/images/graph-down.png",w,b,27,27),z.attr({zIndex:"10",id:k}),z.on("click",function(){// if(!highlowApp.graph.isOneClick(model)) {
highlowApp.betSystem.confirmBet("low",t,e.type)}),z.on("mouseover",function(){o.lowBetButtonHover=!0,r.indexOf("spread")>=0?$("#"+k).attr("href","common/images/graph-down-spread-hover.png"):$("#"+k).attr("href","common/images/graph-down-hover.png")}),z.on("mouseleave",function(){o.lowBetButtonHover=!1,r.indexOf("spread")>=0?$("#"+k).attr("href","common/images/graph-down-spread.png"):$("#"+k).attr("href","common/images/graph-down.png")}),z.add(),z.css({cursor:"pointer"}),o[r].lowButton=z}if(r.indexOf("spread")>=0){var O=n.text('<div class="on-graph-button">'+(t.y+.005).toFixed(3)+"</div>",v+27,y+19);O.on("click",function(){// if(!highlowApp.graph.isOneClick(model)) {
highlowApp.betSystem.confirmBet("high",t,e.type)}),O.on("mouseover",function(){o.highBetButtonHover=!0,r.indexOf("spread")>=0?$("#"+B).attr("href","common/images/graph-up-spread-hover.png"):$("#"+B).attr("href","common/images/graph-up-hover.png")}),O.on("mouseleave",function(){o.highBetButtonHover=!1,r.indexOf("spread")>=0?$("#"+B).attr("href","common/images/graph-up-spread.png"):$("#"+B).attr("href","common/images/graph-up.png")}),O.attr({zIndex:"10",id:"in-chart-spread-high-bet-rate"}),O.css({cursor:"pointer","font-size":"16px;",color:"white"}),O.add();var I=n.text('<div class="on-graph-button">'+(t.y-.005).toFixed(3)+"</div>",w+27,b+19);I.on("click",function(){// if(!highlowApp.graph.isOneClick(model)) {
highlowApp.betSystem.confirmBet("low",t,e.type)}),I.on("mouseover",function(){o.lowBetButtonHover=!0,r.indexOf("spread")>=0?$("#"+k).attr("href","common/images/graph-down-spread-hover.png"):$("#"+k).attr("href","common/images/graph-down-hover.png")}),I.on("mouseleave",function(){o.lowBetButtonHover=!1,r.indexOf("spread")>=0?$("#"+k).attr("href","common/images/graph-down-spread.png"):$("#"+k).attr("href","common/images/graph-down.png")}),I.css({cursor:"pointer","font-size":"16px;",color:"white"}),I.attr({zIndex:"10",id:"in-chart-spread-low-bet-rate"}),I.add(),o[r].highRate=O,o[r].lowRate=I}}},placeBet:function(e){var t=$("#"+e.type+"-graph").highcharts(),o=(t.series[0],t.renderer),r=t.xAxis[0];void 0!=e.marker&&e.marker.destroy();var a=e.point.plotX,n=e.point.plotY,i=a+40,s=n-24,d=i,p=n+4,h=a+28,l=n-48,m=a+28,g=n+40,c=h+21,x=l+12,u=m+21,f=g+12;switch(e.direction){case"high":var v=o.image("common/images/high-lose.png",i,s,21,28);v.css({cursor:"pointer"}),v.attr({zIndex:10}),v.add();var y=o.rect(h,l,43,16,0),w=o.text(e.strike,c,x);break;case"low":var v=o.image("common/images/low-lose.png",d,p,21,28);v.css({cursor:"pointer"}),v.attr({zIndex:10}),v.add();var y=o.rect(m,g,43,16,0),w=o.text(e.strike,u,f)}y.attr({zIndex:14}),y.css({display:"none"}),w.attr({zIndex:14}),w.css({display:"none"}),w.attr({width:"42px","text-anchor":"middle"}),v.on("click",function(){e.expired||highlowApp.betSystem.sellPopup(e)}),v.on("mouseover",function(){e.model.type.indexOf("on-demand")>=0&&!e.expired&&(e.hover=!0,e.model.hoveredBet=e,highlowApp.marketSimulator.updateBetStatus(e.model)),"high"==e.direction?v.css({"-ms-transform-origin":"center bottom","transform-origin":"center bottom","-moz-transform-origin":"center bottom","-webkit-transform-origin":"center bottom","-ms-transform":"scale(1.1,1.1)","-webkit-transform":"scale(1.1,1.1)","-moz-transform":"scale(1.1,1.1)",transform:"scale(1.1,1.1)"}):v.css({"transform-origin":"center top","-moz-transform-origin":"center top","-webkit-transform-origin":"center top","-ms-transform":"scale(1.1,1.1)","-webkit-transform":"scale(1.1,1.1)","-moz-transform":"scale(1.1,1.1)",transform:"scale(1.1,1.1)"}),y.css({display:"block"}),w.css({display:"block"})}),v.on("mouseout",function(){e.model.type.indexOf("on-demand")>=0&&(e.hover=!1,e.model.hoveredBet=void 0,highlowApp.marketSimulator.updateBetStatus(e.model)),v.css({"-ms-transform":"scale(1,1)",transform:"scale(1,1)","-webkit-transform":"scale(1,1)","-moz-transform":"scale(1,1)"}),y.css({display:"none"}),w.css({display:"none"})}),y.attr({zIndex:10}),y.attr({fill:"#161515"}),w.attr({zIndex:11}),y.add(),w.add(),e.markerValueLabel=y,e.markerValueText=w,e.marker=v;var b=e.model;if(b.type.indexOf("on-demand")>=0){{var B=b.type+"-expiry-hint-line";b.type+"-expiry-hint-text"}r.removePlotLine(B),void 0!=b.onDemandHintText&&(b.onDemandHintText.destroy(),b.onDemandHintText=void 0)}},addPoint:function(e,t){var o=this.graphs[e.type],r=o.series[0];r.points[r.points.length-1].update({marker:{enabled:!1}}),r.addPoint(t,!0,!1,!1),this.updateOnGraphUI(e,r.points[r.points.length-1])},prepareGraph:function(e,t){var o={fontFamily:'"Roboto","Helvetica Neue",Helvetica, Arial, sans-serif',fontSize:"10px",color:"white"},r=""+3e5;return t&&(r=""+t),$(e).highcharts({chart:{type:"area",animation:!1,backgroundColor:"#353535",marginTop:6,marginLeft:50,renderTo:"container",style:{fontFamily:'"Roboto","Helvetica Neue",Helvetica, Arial, sans-serif',fontSize:"10px",color:"white",overflow:"visible",zIndex:"4"},startOnTick:!1,endOnTick:!1},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{area:{lineColor:"#ffa200",lineWidth:2,marker:{enabled:!1}},series:{marker:{enabled:!1,states:{hover:{enabled:!1}},zIndex:1e4}}},series:[{color:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"#ffe048"],[1,"#ffc539"]]},fillOpacity:"1",name:"",type:"area",data:[],threshold:null,marker:{enabled:!1}}],yAxis:{labels:{style:o,format:"{value:.3f}"},gridLineWidth:1,gridLineColor:"#202020",tickInterval:.002,tickWidth:0,lineColor:"#202020",lineWidth:1,startOnTick:!1,endOnTick:!0,title:{text:null}},xAxis:{labels:{style:o},minPadding:0,gridLineWidth:1,gridLineColor:"#202020",dateTimeLabelFormats:{second:"%H:%M",minute:"%H:%M",hour:"%H:%M:%S",day:"%H:%M",week:"%H:%M"},ordinal:!1,lineColor:"#202020",lineWidth:1,tickInterval:r,tickWidth:0,type:"datetime",lineColor:"transparent"},title:{text:""},tooltip:{enabled:!1},subtitle:{text:""}})}};