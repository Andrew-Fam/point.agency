highlowApp.favourite={favourite:{},itemPerPage:5,init:function(){var e=this;$(".instrument-panel").on("click",".instrument-panel-favourite",function(a){var t=$(this),r=$(t.closest(".instrument-panel")),i=r.data(highlowApp.marketSimulator.modelDataName);a.stopPropagation(),t.hasClass("faved")?e.unFavorItem(t,i):e.favorItem(t,i)})},unFavorItem:function(e,a){e.removeClass("faved"),e.attr("title","Add to Favourites");var t=this;t.favourite[a.type]&&t.favourite[a.type].map[a.uid]&&(a.favourite=!1,t.favourite[a.type].array.splice(t.favourite[a.type].array.indexOf(a),1),t.removeFromFavouriteTab(a),delete t.favourite[a.type].map[a.uid],t.rerender(a))},favorItem:function(e,a){e.addClass("faved"),e.attr("title","Remove from Favourites");var t=this;t.favourite[a.type]||(t.favourite[a.type]={map:{},array:[]}),a.favourite=!0,t.favourite[a.type].map[a.uid]=a,t.favourite[a.type].array.push(a),t.addToFavouriteTab(a)},addToFavouriteTab:function(e){var a=$("#"+e.type+"-favourite-pages .pages-wrapper"),t=$("#"+e.type+"-"+e.durationId+"-pages [data-uid='"+e.uid+"']"),r=t.clone(!0,!0);r.data(highlowApp.marketSimulator.modelDataName,t.data(highlowApp.marketSimulator.modelDataName)),r.removeClass("instrument-panel-active");var i=$("#"+e.type+"-favourite-pages .page.active"),p=(i.index(),$("#"+e.type+"-favourite-pages .pages-wrapper .page"));p.length>0&&($panels=$($(p[p.length-1]).find(".instrument-panel")));var s;p.length<=0||$panels.length>=5?(s=$('<div class="page"></div>'),p.length<=0&&s.addClass("active")):s=$(p[p.length-1]),s.append(r),a.append(s),i=$("#"+e.type+"-favourite-pages .page.active"),i.next().addClass("next"),i.prev().addClass("prev"),$("#"+e.type+"-favourite-pages .no-data").addClass("hidden"),$('.instrument-panel[data-uid="'+e.uid+'"] .instrument-panel-favourite').addClass("faved")},removeFromFavouriteTab:function(e){var a=$("#"+e.type+"-favourite-pages [data-uid='"+e.uid+"']");$("#"+e.type+"-"+e.durationId+"-pages [data-uid='"+e.uid+"'] .instrument-panel-favourite").removeClass("faved"),$("#"+e.type+"-all-pages [data-uid='"+e.uid+"'] .instrument-panel-favourite").removeClass("faved"),a.remove()},rerender:function(e){var a=this,t=$("#"+e.type+"-favourite-pages .pages-wrapper .instrument-panel"),r=$("#"+e.type+"-favourite-pages .pages-wrapper");t.detach();var i=$("#"+e.type+"-favourite-pages .page.active").index();i||(i=0);for(var p,s=$("#"+e.type+"-favourite-pages .page"),v=0;v<t.length;v++){v%a.itemPerPage==0&&(p=v/a.itemPerPage>=s.length-1?$('<div class="page"></div>'):$(s[v/a.itemPerPage]),v/a.itemPerPage==i&&p.addClass("active"));var o=$(t[v]);p.append(o),v/a.itemPerPage>=s.length-1&&r.append(p)}var n=t.length/a.itemPerPage;if(n<s.length)for(var v=s.length;v>n;v--)$(s[v-1]).remove();s=$("#"+e.type+"-favourite-pages .page"),i<s.length?$(s[i]).addClass("active").removeClass("prev").removeClass("next").css({left:"0px"}):$(s[i-1]).addClass("active").removeClass("prev").removeClass("next").css({left:"0px"});var d=$("#"+e.type+"-favourite-pages .page.active");d.next().addClass("next"),d.prev().addClass("prev"),0==t.length&&$("#"+e.type+"-favourite-pages .no-data").removeClass("hidden")}};