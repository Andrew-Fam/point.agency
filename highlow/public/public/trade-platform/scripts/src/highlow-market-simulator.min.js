highlowApp.marketSimulator={instruments:[],spread:.005,rounding:3,minInterval:1e3,maxInterval:1500,maxChange:8e-4,modelDataName:"instrumentModel",start:function(){for(var e=0;e<this.instruments.length;e++){var t=this.instruments[e];t.update(),t.updateTime()}},simulate:function(e){var t=this,a=highlowApp.randomValue(0,t.maxChange,4),i=.5;e.absoluteChange>0?i+=.1:e.absoluteChange<0&&(i-=.1),e.absoluteChange>.002?i+=.3:e.absoluteChange<.002&&(i-=.3);var r=Math.random()>=i?a:-a;e.previousRate=parseFloat(e.currentRate),e.currentRate=parseFloat(e.currentRate+r),e.absoluteChange+=parseFloat(r),e.type.indexOf("spread")>=0&&(e.upperRate=parseFloat(parseFloat(e.currentRate)+t.spread),e.lowerRate=parseFloat(parseFloat(e.currentRate)-t.spread));var n=(new Date).getTime();e.type.indexOf("on-demand")<0&&n>=e.expireAt-12e4&&(e.dead=!0),e.active&&highlowApp.graph.addPoint(e,{x:n,y:e.currentRate,marker:{enabled:!0,symbol:"url(common/images/graph-marker.png)"},states:{hover:{enabled:!1}},zIndex:10}),e.data.push({x:n,y:e.currentRate,marker:{enabled:!1}}),t.updateUI(e.uid,e),t.updateBetStatus(e)},updateBetStatus:function(e){for(var t=(new Date).getTime(),a=$("#"+e.type+"-graph").highcharts(),i=(a.series[0],a.xAxis[0]),r=a.renderer,n=0;n<e.bets.length;n++){var o=e.bets[n],d=o.marker,l=parseFloat(e.currentRate).toFixed(this.rounding),s=o.point,p=!1,u=parseFloat(o.strike).toFixed(this.rounding),h=!1,m=!1;if(void 0!=o.expireAt&&o.expireAt<t&&!o.expired&&(h=!0,o.expired=!0,o.closingRate=l),m=h||!o.focused,e.active){var g=s.plotX,x=s.plotY,d=o.marker,f=o.markerValueLabel,c=o.markerValueText,v=g+28,w=x-48,y=g+28,b=x+40,R=v+21,I=w+12,T=y+21,A=b+12;switch(o.direction){case"high":d.attr({x:s.plotX+39,y:s.plotY-24}),f.attr({x:v,y:w}),c.attr({x:R,y:I});break;case"low":d.attr({x:s.plotX+39,y:s.plotY+4}),f.attr({x:y,y:b}),c.attr({x:T,y:A})}if(!o.expired){switch(o.direction){case"high":l>u?(d.attr({href:"common/images/high-win.png",zIndex:10}),p=!0):u>=l&&d.attr({href:"common/images/high-lose.png",zIndex:11});break;case"low":l>=u?d.attr({href:"common/images/low-lose.png",zIndex:10}):u>l&&(d.attr({href:"common/images/low-win.png",zIndex:11}),p=!0)}o.focused&&(d.attr({zIndex:14}),$($(o.markerValueLabel.element).parent()).append(o.markerValueLabel.element),$($(o.markerValueText.element).parent()).append(o.markerValueText.element),$($(d.element).parent()).append(d.element))}if(e.type.indexOf("on-demand")>=0){var C=e.type+"-plot-band-"+e.uid+"-"+n,F=e.type+"-start-plot-line-"+e.uid+"-"+n,L=e.type+"-end-plot-line-"+e.uid+"-"+n,V=e.type+"-finish-text-"+e.uid+"_"+n,z=e.type+"-finish-label-"+e.uid+"_"+n;if(o.plotBandId=C,o.startLineId=F,o.endLineId=L,o.finishTextId=V,o.finishLabelId=z,i.removePlotBand(C),i.removePlotLine(F),i.removePlotLine(L),!o.focused&&!o.hover||o.expired)void 0!=o.finishText&&(o.finishText.destroy(),o.finishLabel.destroy(),o.finishText=void 0,o.finishLabel=void 0);else{var M=(s.plotX,Math.floor(i.toPixels(o.expireAt)-17)),k=r.rect(M,52,17,177,0),B=M+12,D=141,P={id:o.finishTextId,transform:"translate(0,0) rotate(270 "+B+" "+D+")",width:"177px","text-anchor":"middle"},O={fill:"#f8f7f5"};o.focused&&!o.hover&&e.hoveredBet?(i.addPlotLine({color:"rgba(255,255,255,0.34)",value:o.betAt,width:1,zIndex:4,id:F}),i.addPlotLine({color:"rgba(255,255,255,0.34)",value:o.expireAt,width:1,zIndex:4,id:L}),O.zIndex="2",P.zIndex="6"):(i.addPlotBand({color:"rgba(20,20,20,0.3)",from:o.betAt,to:o.expireAt,zIndex:1,id:C}),i.addPlotLine({color:"rgba(255,255,255,0.7)",value:o.betAt,width:1,zIndex:1e3,id:F}),i.addPlotLine({color:"rgba(255,255,255,0.7)",value:o.expireAt,width:1,zIndex:4,id:L}),o.hover&&!o.focused?(O.zIndex="15",P.zIndex="15"):(O.zIndex="4",P.zIndex="4"),$($(o.markerValueLabel.element).parent()).append(o.markerValueLabel.element),$($(o.markerValueText.element).parent()).append(o.markerValueText.element),$($(d.element).parent()).append(d.element),d.attr({zIndex:14})),void 0==o.finishLabel?(o.finishLabelId=z,k.attr(O),k.add(),o.finishLabel=k):o.finishLabel.attr({x:M}),void 0==o.finishText?(o.finishTextId=V,text=r.text("loading...",B,D),text.css({"font-family":"Montserrat","font-size":"10px;",color:"#4d5158"}),text.attr(P),text.add(),o.finishText=text):o.finishText.attr({x:B,transform:"translate(0,0) rotate(270 "+B+" "+D+")"}),o.focused&&!o.hover&&e.hoveredBet?(o.finishText.attr({opacity:"0.7"}),o.finishLabel.attr({opacity:"0.34"})):(o.finishText.attr({opacity:"1"}),o.finishLabel.attr({opacity:"1"}))}}}highlowApp.betSystem.updateBetEntry(o,e)}},updateUI:function(e,t){{var a=$('[data-uid="'+e+'"]'),i=(t.type,this);(new Date).getTime()}if(t.type.indexOf("spread")>=0){var r=$(a.find(".instrument-panel-rate.highlow-high")),n=$(a.find(".instrument-panel-rate.highlow-low"));r.html(" "+parseFloat(t.upperRate).toFixed(i.rounding)),n.html(" "+parseFloat(t.lowerRate).toFixed(i.rounding))}else{var o=$(a.find(".instrument-panel-rate"));o.html(" "+parseFloat(t.currentRate).toFixed(i.rounding)),t.currentRate>t.previousRate?o.removeClass("highlow-low").addClass("highlow-high"):t.currentRate<t.previousRate&&o.removeClass("highlow-high").addClass("highlow-low")}},updateRemainingTime:function(e){if(e.type.indexOf("on-demand")<0){var t=$('[data-uid="'+e.uid+'"]'),a=($(t.find(".expiry-time")),(new Date).getTime()),i="",r=e.getMainViewId();remainingTime=e.expireAt-a,i=highlowApp.durationToText(remainingTime),0>=remainingTime&&(e.expired=!0),e.active&&$("#"+r+" .trading-platform-instrument-time-left").html(" "+i)}else this.updateOnDemandBet=function(t,a){var i="EXPIRY: ",n="",o=(new Date).getTime(),d=new Date(t.expireAt-o),l=d.getMinutes(),s=d.getSeconds();l>0?(i+=l>9?l:"0"+l,n+=l>9?l:"0"+l+":",i+=l>1?" MINS ":" MIN "):n+="0:",(s>0||l>0)&&(i+=s>9?s:"0"+s,n+=s>9?s:"0"+s,i+=s>1?" SECS ":" SEC "),(o>=t.expireAt||0>=s&&0>=l)&&(i="EXPIRED",n="expired"),void 0!=t.finishText&&t.finishText.attr({text:i}),e.active&&a&&(r=e.getMainViewId(),$("#"+r+" .trading-platform-instrument-time-left").html(" "+n))},e.focusedBet&&this.updateOnDemandBet(e.focusedBet,!0),e.hoveredBet&&this.updateOnDemandBet(e.hoveredBet)},init:function(){var e=this;$(".js-instrument-panel-original").each(function(){var t={},a=$(this),i=(new Date).getTime();t.label=a.data("instrumentLabel"),t.type=a.data("tradingType"),t.durationLabel=a.data("instrumentDuration"),t.durationId=a.data("instrumentDurationId"),t.duration=a.data("instrumentDurationValue"),t.seedRate=a.data("instrumentSeedRate"),t.payoutRate=a.data("instrumentPayoutRate"),t.currentRate=parseFloat(t.seedRate).toFixed(e.rounding),t.previousrate=t.currentRate,t.bets=[],t.uid=a.data("uid"),t.type.indexOf("on-demand")<0&&(t.openAt=highlowApp.expiring()?i-78e4:1e3*(Math.round(i/3e5)-1)*60*5,t.expireAt=t.openAt+t.duration,9e5==t.duration?t.deadzone=t.expireAt-12e4:36e5==t.duration?t.deadzone=t.expireAt-3e5:864e5==t.duration&&(t.deadzone=t.expireAt-9e5));var r=24e5,n=1e3,o=5e3;t.duration>9e5&&(r=36e5,n=1e4,o=5e4),t.duration>36e5&&(r=144e5,n=4e4,o=2e5),t.startingPoint=i-r,t.absoluteChange=0,t.data=[],t.data.push({x:t.startingPoint,y:t.seedRate});for(var d=t.startingPoint,l=1;i>d;d+=highlowApp.randomValue(n,o),l++){var s=highlowApp.randomValue(0,e.maxChange,4),p=.5;t.absoluteChange>0?p+=.1:t.absoluteChange<0&&(p-=.1),t.absoluteChange>.002?p+=.3:t.absoluteChange<-.002&&(p-=.3);var u=Math.random()>=p?s:-s;t.absoluteChange+=parseFloat(u);var h={x:d,y:t.data[l-1].y+u};t.data.push(h),t.previousRate=t.currentRate,t.currentRate=h.y}"spread"===t.type&&(t.upperRate=parseFloat(t.currentRate+e.spread).toFixed(e.rounding),t.lowerRate=parseFloat(t.currentRate-e.spread).toFixed(e.rounding)),t.getMainViewId=function(){return t.type+"-main-view"},t.updateMainView=function(){var a=t,i=a.getMainViewId();if($("#"+i).data(e.modelDataName,t),$("#"+i+" .trading-platform-instrument-duration").html(" "+a.durationLabel),$("#"+a.type+"-mode .trading-platform-main-controls-payout-rate").html(a.payoutRate),$("#"+i+" .trading-platform-instrument-title, #"+a.type+"-mode .trading-platform-main-controls-instrument-title, .trading-platform-invest-popup."+a.type+" .trading-platform-main-controls-instrument-title").html(" "+a.label),$("#"+i+" .trading-platform-maximum-return").html("$"+parseFloat(a.payoutRate*$("#"+a.type+"-investment-value-input").val()).toFixed(2)),a.active){a.dead?$("#"+a.getMainViewId()).addClass("dead"):$("#"+a.getMainViewId()).removeClass("dead");var r=$("#"+a.getMainViewId()+" .current-rate"),n=$(".trading-platform-invest-popup."+a.type+" .current-rate"),o=$(".trading-platform-sell-popup."+a.type+" .current-rate");a.type.indexOf("on-demand")<0?$("#"+i+" .trading-platform-instrument-closing-time").html(" "+highlowApp.timeToText(a.expireAt)):a.focusedBet&&$("#"+i+" .trading-platform-instrument-closing-time").html(" "+highlowApp.timeToText(a.focusedBet.expireAt)),a.currentRate>a.previousRate?(r.removeClass("highlow-low").addClass("highlow-high"),n.removeClass("highlow-low").addClass("highlow-high"),o.removeClass("highlow-low").addClass("highlow-high")):a.currentRate<a.previousRate&&(r.removeClass("highlow-high").addClass("highlow-low"),n.removeClass("highlow-high").addClass("highlow-low"),o.removeClass("highlow-high").addClass("highlow-low")),r.html(" "+parseFloat(a.currentRate).toFixed(e.rounding)),n.html(" "+parseFloat(a.currentRate).toFixed(e.rounding)),o.html(" "+parseFloat(a.currentRate).toFixed(e.rounding))}},t.update=function(){var a=t;e.simulate(a),a.active&&a.updateMainView(),t.expired&&t.type.indexOf("on-demand")<0&&(t.openAt=1e3*(Math.round(i/3e5)-1)*60*5,t.expireAt=t.openAt+t.duration),setTimeout(a.update,Math.floor(highlowApp.randomValue(e.minInterval,e.maxInterval)))},t.updateTime=function(){var a=t;e.updateRemainingTime(a),t.expired||setTimeout(a.updateTime,1e3)},$('[data-uid="'+a.data("uid")+'"]').data(e.modelDataName,t),$('[data-uid="'+a.data("uid")+'"] .closing-at').html(highlowApp.timeToText(t.expireAt)),e.instruments.push(t)}),e.start()}};